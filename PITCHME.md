
Principles of Concurrent and Distributed Programming  
邦題: 並行分散プログラミングの原理  

---

## 目次
 凡例  
 1 並行プログラミングとは?  
 2 並行プログラミング抽象化  
 3 クリティカルセクション問題  
 まとめ  
 参考文献

---

## 凡例
本資料は、「Principles of Concurrent and Distributed Programming」
(以下PCDPと略す)の各章節を要約し、その理解の補助を目的とする。

_斜体_の語句は専門用語(Terminology)であることを示す。その基準はPCDPに準拠す。

章毎に要約方法の試行錯誤有るも、悪しからず。

---

## 1 並行プログラミングとは?
| 訳語表 | 英語 | 日本語 |
|--|--|--|
|  | concurrent | 並行な |
|  | parallel | 並列な |
|  | sequential | 逐次(的な) |

+++

### 1.1 導入 逐次実行
"普通"のプログラムはデータの宣言と代入、制御文からなる。

```java
int a; // データの宣言
a = 1; // データの代入
if (a == 1)
  print("if文は制御文")
```

コンパイルの結果、CPUの命令として、機械語(バイナリ)に現る。
_逐次(順番に)_実行され、主記憶や外部記憶装置にアクセスする。

+++

### 1.1 導入 定義: 並行プログラム
_並行プログラム_とは、並列に実行可能な逐次プログラムの集合である。

_プロセス_とは、並行プログラムの構成要素となるような逐次プログラムである。

用語としての_プログラム_とは、プロセスの集合である。

+++

### 1.1 導入 並列と並行
_並列_という単語はプログラムを異なるプロセッサで実行することでその各々の実行がやがては被る様なシステムに用いられる。

_並行_という単語は、その実行が、必須ではないが被り得る様な潜在的な並列性に用いられる。

つまり、_並列_とは実際に処理が同時に実行されていることだが、_並行_ではそうなり得る、あるいはその様な状態にみえることである。_並行_では、実際に並列に実行されない可能性がある。  
**並列∈並行**

+++

### 1.1 導入 並列と並行
人に仕事を頼むとき

「これとこれ、並行してやって」

とはいっても

「これとこれ、並列してやって」

とはいわないのと同じ。右手と左手にペンをもって同時(並列)に文章書いたりしませんよね!?

少数のプロセッサと資源を共有するを以て実装されるような時だけ、並列性が顕になり得る。

+++

### 1.1 導入 まとめ
* プロセスが総て並列に実行されていると仮定することで、このようなプログラムをよく理解できる。
これが並行性という抽象化の有益たる所以である。
* 並行プログラムを成す様なプロセスは相互に作用し、正しいプログラムを書くのを著しく阻害する。
* 並行プログラミングは現実のシステム開発に起こる問題に対処するために生じた。

以降の節では、現実の世界の並行性の具体例をみていく。

+++

### 1.1 導入 おまけ
Oracle社員Brian Goetzによる「From Concurrent to Parallel」於Jfokus 2016

_並行性_とは正確かつ効率的に共有資源に対するアクセスを制御すること

* 例: スレッド安全なデータ構造の構築
* 基本要素 (同期プリミティブ): ロック、イベント、セマフォ、コルーチン、STM(Software Transactional Memory)

_並列性_とは高速に解を得るため追加の資源を用いること

* 例: 分割による巨大なデータの集合の探索

+++

### 1.2 抽象並列性としての並行性
なんかたいしたこと書いてない。

+++

### 1.3 マルチタスキング
_マルチタスキング_とは、I/Oと計算の重複という概念から、他のプログラムの計算との重複への単純な一般化である。

計算資源(CPU)は公平に総てのプログラム間で共有すべし。為にカーネルのスケジューラーにあっては、計算は定期的に割り込みが走る。(コンテキストスイッチ)  
→ ワードで文書を書きつつ、他の文書を印刷して、同時にファイルをダウンロードできる所以。

+++

### 1.3 マルチタスキング
最近のプログラミング言語が_マルチスレッド_の対応を提供する程、マルチタスキングは有用なものとなっている。

マルチスレッドによって、並行計算が可能になり、メインスレッドで計算しつつ、他スレッドでUIの処理をすることが可能になった。

プログラムが計算をしている間、マウスカーソルを動かせるのは、マルチスレッディングのおかげである。(意味不明)

+++

### 1.4 並行性に関する用語
_プロセス_: OSの管理する所の自身のアドレス空間で走るもの  
_スレッド_: 単一のプロセスのアドレス空間内で走り、プロセス内部でマルチスレッディングカーネルによって管理されるもの

_プロセス_、_スレッド_の区別は「同期」の分野、これに関知せず。故に、以後_プロセス_を用いる。

_タスク_: 我々の呼称する所のプロセス。Ada言語に用いられる。又、仕事の小さな単位にも用いられる。

+++

### 1.5 複数の計算機
現在では、それぞれの仕事に特化した独自のプロセッサが備わっている。(GPU、I/Oと通信回路等)  
OSカーネルのマルチプタスキングに加えて、パラレルプロセッシングも行われている。

一台の計算機では不可能な計算を行う場合にも、複数台の計算機が使われる。  
例: インターネット関連企業の膨大な数の顧客にサービスを提供するために使用される膨大な数の計算機(server farm)  
実際、インターネット全体が、emailやウェブの形で情報を提供するために動いている、一つの分散システムとみなし得る。

何故か分散システムより馴染みのないものとして、_マルチプロセッサ_がある。  
これは、複数のプロセッサの計算力を引き出し、協調して、ひとつの集中計算的問題を解くように設計される。科学、工学シミュレーションに用いられる。

+++

### 1.6 並行プログラミングの挑戦
プロセス間が独立的でない限りは、以下の制約あり。
* 複数のプロセスの実行を同期する必要生
* プロセス間の通信

安全で効率的な同期と通信を実装するのはかなり困難。

フリーズや、アプリケーションが他のフリーズを引き起こすのは一般に、同期と相互通信に問題がある。
この問題は、時間や状況依存であるため、再現、調査、修正が困難。

+++

### 1.6 並行プログラミングの挑戦
本書の狙いは、並行分散プログラムの正しい振る舞いを備えたアルゴリズムとシステムの紹介にある。


---


## 2 並行プログラミング抽象化

+++

### 2.1 抽象化の役割
抽象化(abstraction)とは、下層の詳細をその上の層で隠すことである。つまり、抽象化された層より下の層を考える必要がない。(そもそもその存在を認知しない)

ソフトウェア高額では、一般に以下の三段階の抽象化を扱う。

+++

### 2.1 抽象化の役割 システムとライブラリ

* システムとライブラリ

APIとも呼ばれる、OSとライブラリはプログラムから利用可能な計算資源を定義する。
その実装の委細を知らずとも、正しい手続きや関数呼び出しで、ファイルを開いたり、メッセージを送ったり出来る。

+++

### 2.1 抽象化の役割 プログラミング言語

* プログラミング言語

プログラミング言語は、特定のアーキテクチャの詳細を除いて、計算機の計算能力を使用させてくれる。

+++

### 2.1 抽象化の役割 命令セット

* 命令セット

計算機メーカーは、アセンブリ言語プログラマやコンパイラ書きから見える様な、同じ命令セットを実行できる
CPUファミリーを設計し製造する。CPUファミリーをメンバーは、全く異なる手法で実装され得るが、
ソフトウェアでエミュレートして、コンパイラをその実装の詳細を知らずして、その命令セットむけのコンパイラを書ける。

+++

### 2.1 抽象化の役割
ソフトウェア抽象化の重要なツールとして、カプセル化と平行である。

+++

### 2.1 抽象化の役割 カプセル化
ソフトウェア抽象化の重要なツールとして、カプセル化と平行である。

ソフトウェアモジュールを、公開仕様と秘匿実装とに分割することである。

仕様は、データ構造や実世界のモデルで利用可能な操作を記述する。よって内部のデータ表現とアルゴリズムが変化しても、システムの他のプログラミングに影響を与えない。

+++

### 2.1 抽象化の役割 並行
並行とは、プログラムの動的な動作の推論を可能にするべく設計される抽象化である。

以降では、並行の抽象化について示す。

+++

### 2.2 アトミック文のかさなりとしての並行実行



+++

---

## 3 クリティカルセクション問題

---

## 参考文献
